input {
  file {
    path => "/app/logs/*.log"
    start_position => "beginning"
    sincedb_path => "/dev/null"
    codec => json
  }
  
  beats {
    port => 5044
  }
}

filter {
  if [service] == "investment_analysis" {
    mutate {
      add_tag => ["investment-analysis"]
    }
    
    # Parse log level
    if [level] {
      mutate {
        uppercase => ["level"]
      }
    }
    
    # Add timestamp processing
    date {
      match => ["timestamp", "ISO8601"]
    }
    
    # Extract error information
    if [level] == "ERROR" and [exception] {
      mutate {
        add_field => {
          "error_type" => "%{[exception][type]}"
          "error_message" => "%{[exception][message]}"
        }
      }
    }
  }
}

output {
  elasticsearch {
    hosts => ["elasticsearch:9200"]
    index => "investment-analysis-logs-%{+YYYY.MM}"
  }
  
  stdout {
    codec => rubydebug
  }
}
