groups:
  - name: warning_alerts
    interval: 1m
    rules:
      # Cost and Budget Warnings
      - alert: HighDailyCost
        expr: daily_cost_dollars > 1.5
        for: 10m
        labels:
          severity: warning
          team: finance
        annotations:
          summary: "Daily cost exceeds warning threshold"
          description: "Daily cost for {{ $labels.service }} is ${{ $value }} (warning threshold: $1.50)"
          
      - alert: ApproachingBudgetLimit
        expr: cost_budget_usage_percent > 80
        for: 15m
        labels:
          severity: warning
          team: finance
        annotations:
          summary: "Approaching monthly budget limit"
          description: "Currently at {{ $value }}% of monthly budget"
          action: "Consider reducing API calls or switching to cost-saving mode"

      # Data Quality Warnings
      - alert: LowDataQualityScore
        expr: data_quality_score < 70
        for: 10m
        labels:
          severity: warning
          team: data
        annotations:
          summary: "Low data quality score for {{ $labels.symbol }}"
          description: "Data quality score is {{ $value }} for {{ $labels.data_type }} (threshold: 70)"
          
      - alert: StaleData
        expr: data_staleness_seconds > 86400
        for: 30m
        labels:
          severity: warning
          team: data
        annotations:
          summary: "Stale data detected for {{ $labels.symbol }}"
          description: "Data for {{ $labels.symbol }} is {{ $value | humanizeDuration }} old"

      - alert: MissingDataPoints
        expr: missing_data_points > 5
        for: 15m
        labels:
          severity: warning
          team: data
        annotations:
          summary: "Missing data points for {{ $labels.symbol }}"
          description: "{{ $value }} missing data points in {{ $labels.period }} period"

      # Performance Warnings
      - alert: HighAPILatency
        expr: histogram_quantile(0.90, rate(api_request_duration_seconds_bucket[5m])) > 2
        for: 10m
        labels:
          severity: warning
          team: platform
        annotations:
          summary: "API latency is elevated"
          description: "90th percentile latency is {{ $value }}s (warning threshold: 2s)"

      - alert: SlowDatabaseQueries
        expr: histogram_quantile(0.90, rate(db_query_duration_seconds_bucket[5m])) > 5
        for: 10m
        labels:
          severity: warning
          team: platform
        annotations:
          summary: "Database queries are slow"
          description: "90th percentile query time is {{ $value }}s for {{ $labels.operation }}"

      - alert: HighErrorRate
        expr: rate(api_errors_total[5m]) > 0.05
        for: 10m
        labels:
          severity: warning
          team: platform
        annotations:
          summary: "High error rate detected"
          description: "Error rate is {{ $value | humanizePercentage }} for {{ $labels.endpoint }}"

      # Resource Usage Warnings
      - alert: ApproachingRateLimit
        expr: rate_limit_remaining / rate_limit_remaining > 0.2
        for: 5m
        labels:
          severity: warning
          team: data
        annotations:
          summary: "Approaching rate limit for {{ $labels.provider }}"
          description: "Only {{ $value }} API calls remaining for {{ $labels.provider }}"

      - alert: HighCacheMissRate
        expr: rate(cache_misses_total[5m]) / (rate(cache_hits_total[5m]) + rate(cache_misses_total[5m])) > 0.3
        for: 10m
        labels:
          severity: warning
          team: platform
        annotations:
          summary: "High cache miss rate"
          description: "Cache miss rate is {{ $value | humanizePercentage }} for {{ $labels.cache_type }}"

      - alert: DatabaseConnectionPoolExhausted
        expr: db_connections_active > 40
        for: 5m
        labels:
          severity: warning
          team: platform
        annotations:
          summary: "Database connection pool near exhaustion"
          description: "{{ $value }} active database connections (max: 50)"

      # Analysis and Processing Warnings
      - alert: SlowAnalysisProcessing
        expr: histogram_quantile(0.90, rate(analysis_duration_seconds_bucket[5m])) > 30
        for: 15m
        labels:
          severity: warning
          team: data
        annotations:
          summary: "Analysis processing is slow"
          description: "90th percentile analysis time is {{ $value }}s for {{ $labels.analysis_type }}"

      - alert: LowMLPredictionAccuracy
        expr: ml_prediction_accuracy < 0.6
        for: 30m
        labels:
          severity: warning
          team: ml
        annotations:
          summary: "ML model accuracy is low"
          description: "{{ $labels.model }} accuracy is {{ $value }} for {{ $labels.horizon }} horizon"

      - alert: HighAnomalyScore
        expr: anomaly_score > 0.7
        for: 10m
        labels:
          severity: warning
          team: data
        annotations:
          summary: "High anomaly score for {{ $labels.symbol }}"
          description: "Anomaly score is {{ $value }} for {{ $labels.data_type }}"

      # External API Warnings
      - alert: ExternalAPIFailureRate
        expr: rate(external_api_failures_total[5m]) > 0.1
        for: 10m
        labels:
          severity: warning
          team: data
        annotations:
          summary: "High failure rate for {{ $labels.provider }}"
          description: "{{ $labels.provider }} API failure rate is {{ $value | humanizePercentage }}"

      - alert: ExternalAPISlowResponse
        expr: histogram_quantile(0.90, rate(external_api_call_duration_seconds_bucket[5m])) > 3
        for: 10m
        labels:
          severity: warning
          team: data
        annotations:
          summary: "Slow response from {{ $labels.provider }}"
          description: "90th percentile response time is {{ $value }}s"

      # Circuit Breaker Warnings
      - alert: CircuitBreakerHalfOpen
        expr: circuit_breaker_state == 2
        for: 10m
        labels:
          severity: warning
          team: platform
        annotations:
          summary: "Circuit breaker {{ $labels.breaker_name }} in half-open state"
          description: "Circuit breaker has been in half-open state for 10 minutes"

      - alert: FrequentCircuitBreakerTrips
        expr: rate(circuit_breaker_failures_total[1h]) > 5
        for: 15m
        labels:
          severity: warning
          team: platform
        annotations:
          summary: "Circuit breaker {{ $labels.breaker_name }} tripping frequently"
          description: "Circuit breaker has failed {{ $value }} times in the last hour"